<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test items</title>

    <!-- bootstrap  -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
    <!-- jQuery  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Moment  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>

    <!-- CSS Testing Section -->
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/style.css">

    <style>
        /* :root {
            --speed: 'km/h';
            --pressure: 'hPa';
        } */

        * {
            font-family: 'Open Sans', sans-serif;
            font-size: 16px;
            line-height: 1;
        }

        .today-info {
            text-align: left;
        }

        #tempToday::before {
            content: 'Temperature: ';
        }

        #dtToday::before {
            content: 'time: ';
        }

        */ #sunriseToday::before {
            content: 'sunrise: ';
        }

        #sunsetToday::before {
            content: 'sunset: ';
        }

        #tempToday::before {
            content: 'temperature: ';
        }

        #feels_likeToday::before {
            content: 'feels like: ';
        }

        #pressureToday::before {
            content: 'pressure: ';
        }

        #humidityToday::before {
            content: 'humidity: ';
        }

        #dew_pointToday::before {
            content: 'dew point: ';
        }

        #uviToday::before {
            content: 'UV index: ';
        }

        #cloudsToday::before {
            content: 'clouds: ';
        }

        #visibilityToday::before {
            content: 'visibility: ';
        }

        #wind_speedToday::before {
            content: 'wind speed: ';
        }

        #wind_degToday::before {
            content: 'wind direction: ';
        }

        #descriptionToday::before {
            content: 'description: ';
        }

        .degT::after {
            content: var(--degT);
        }
        .deg::after {
            content: var(--deg);
        }

        .presr::after {
            content: var(--pressure);
        }

        /* .deg::after{ content:" &#8451;";} * / */
        .perc::after {
            content: '%';
        }

        .spd::after {
            content: var(--speed);
        }
    </style>
    <script>
        // Get the root element
        var rootVar = document.querySelector(':root');


        // Create a function for setting a variable value
        function unitSuffix_set() {
            // Set the value of variable - note the " need to be in the final
                        rootVar.style.setProperty('--degT',  `'Â°F'` );
            rootVar.style.setProperty('--speed', `'MPH'`);
        }
        unitSuffix_set()
    </script>
</head>

<!-- HTML testing section  -->

<body>
    <p id="test" style="background-color:var(--dark)">Test</p>
    <!-- Icons from weather in format '02n' the @4x is to make it 4times bigger-->
    <img src="https://openweathermap.org/img/wn/02n@4x.png" alt="example icon" srcset="">
    <hr>
    <br>
    <!-- testing html here  -->


    <!-- End window modal -->
    <!-- Search panel on LHS  
     <div id="search-panel">
        <div id="searchForm">
            <h2>Search for a City:</h2>
            <input type="text" name="city" id="cityInput" default="city">
            <button id="searchBtn" class="btn  btnSearch">Search</button>
        </div>
        <hr>
        <div class="collapse" id="favourites">Favourites</div>
        <div id="locationButtons">
            <button class="btn btnCity" data-search-term="Melbourne,Victoria,AU">Melbourne</button>
        </div>
    </div>-->

    <div id="info-panel">
        <div id="todayWeather" class="fCast"> <span class="">Melbourne</span>  <span class="today-info" id="dtToday">28 Jun 2022 8:45pm</span>

            <div class="today-info" id="sunriseToday">1656544655</div>
            <div class="today-info" id="sunsetToday">1656580944</div>
            <div class="today-info degT" id="tempToday">284.11</div>
            <div class="today-info degT" id="feels_likeToday">283.35</div>
            <div class="today-info presr" id="pressureToday">1031</div>
            <div class="today-info perc" id="humidityToday">80</div>
            <div class="today-info degT" id="dew_pointToday">280.8</div>
            <div class="today-info" id="uviToday">0</div>
            <div class="today-info" id="cloudsToday">0</div>
            <div class="today-info length" id="visibilityToday">10000</div>
            <div class="today-info spd" id="wind_speedToday">3.6</div>
            <div class="today-info  deg" id="wind_degToday">130</div>
            <!-- <div class="today-info" id=" idToday">800</div> -->
            <div class="today-info" id="mainToday">Clear</div>
            <div class="today-info" id="descriptionToday">clear sky</div>
            <div class="today-info" id="iconToday">01n</div>
        </div>
    </div>
</body>
<!-- Javascript testing section ----------------------------------------------JS-------------->
<!-- Below script will save the units for weather -->
<script src="../js/units_Weather.js"></script>

<!-- <script src="../js/script.js"></script> -->
<script>
    
        // Get the root element
        var r = document.querySelector(':root');

        // Create a function for getting a variable value
        function myFunction_get() {
            // Get the styles (properties and values) for the root
            var rs = getComputedStyle(r);
            // Alert the value of the --blue variable
            alert("The value of --blue is: " + rs.getPropertyValue('--dark'));
        }

  




    // document.getElementById('test').textContent = "Script working";

    //From main script-------------
    var apiKey = '37572b676fcac9bf15842774f3087088';
    var exclusions = 'minutely' // allow for 'current,minutely,hourly,daily,alerts'
    var unitsPref = 'metric'; // allow toggle 'imperial'
    var alertsPref = 'on'; // allow toggle 'off'
    var fullCurrentWeather = {};

    //----Units
    var unitsInfo = JSON.parse(localStorage.getItem('unitsData')).obj;

    // var unitsInfo = (localStorage.getItem('unitsData'));
    // var unitsMap = new Map(Object.entries(unitsInfo));


    function locationAPI(searchTerm) {
        //  https://api.openweathermap.org/geo/1.0/direct?q=melbourne&limit=5&appid=37572b676fcac9bf15842774f3087088

        var requestUrl = 'https://api.openweathermap.org/geo/1.0/direct?q=' + searchTerm + '&limit=1&appid=' + apiKey;
        window.locationData = {};
        fetch(requestUrl)
            .then(function (response) {
                if (response.status != 200) {
                    showWindowModal('Search term not found - Error: ' + response.status)
                }
                console.log(response)
                return response.json();

            })
            .then(function (data) {
                // console.log(data.results);
                console.log('location data:');
                console.log(data);
                // testingVal=data;
                if (data.length < 1) {
                    //showWindowModal('No result was found for that search term, please try again');
                } else {
                    locationData = {
                        'name': data[0].name,
                        'state': data[0].state,
                        'country': data[0].country,
                        'lat': data[0].lat,
                        'lon': data[0].lon,
                    };
                    //addLocationToLocal(JSON.stringify(locationData));
                    weatherAPI(locationData.lat, locationData.lon, exclusions, apiKey);
                }
            });
    }

    function weatherAPI(lat, lon, exclude, api_Key) {
        //https://api.openweathermap.org/data/2.5/onecall?lat={lat}&lon={lon}&exclude={part}&appid={API key}

        var requestUrl = 'https://api.openweathermap.org/data/2.5/onecall?lat=' + lat + '&lon=' + lon + '&exclude=' + exclude + '&units=' + unitsPref + '&appid=' + api_Key;
        // window.locationData = {};
        fetch(requestUrl)
            .then(function (response) {
                if (response.status != 200) {
                    showWindowModal('Error: ' + response.status)
                }
                console.log(response)
                return response.json();

            })
            .then(function (data) {
                // console.log(data.results);
                console.log(data);
                fullCurrentWeather = data;
                makeCurrentPanel()
            });

    }


    function makeCurrentPanel() {
        var currentWeatherLoc = fullCurrentWeather.current;
        var currentDivs = document.querySelector('#todayWeather').children;
        var replaceIdText = 'Today'

        for (i = 0; i < currentDivs.length; i++) {
            var detailNameId = currentDivs[i].id;
            var detailName = detailNameId.replace(replaceIdText, '');
            var thisDetailVal = eval('currentWeatherLoc.' + detailName)
            // var unitSuffix = eval('unitsInfo.' + detailName + '.' + unitsPref);
            // if (unitSuffix == undefined || unitSuffix== null) { unitSuffix = '' };


            // if (thisDetailVal != null || detailName != null) {
            var thisID = document.getElementById(detailNameId);
            thisID.textContent = thisDetailVal //+' ' + unitSuffix;
            // }

        }
    }

    locationAPI('melbourne,victoria,AU');


</script>

</html>